import asyncio
import aiohttp
import datetime
import time
from http.cookies import SimpleCookie

from tenacity import retry, stop_after_attempt, wait_random
from click import create_driver


class JDCouponSniper:
    def __init__(self, opts, concurrency=5):
        self.scheduled_time = opts.scheduled_time
        self.open_url = opts.open_url
        self.concurrency = concurrency
        self.url = "http://api.m.jd.com/client.action?functionId=newBabelAwardCollection"
        self.headers = {
            'accept': '*/*', 
            'accept-language': 'zh-CN,zh-TW;q=0.9,zh;q=0.8,en-US;q=0.7,en;q=0.6', 
            'cache-control': 'no-cache', 
            'origin': 'http://h5static.m.jd.com', 
            'pragma': 'no-cache', 
            'priority': 'u=1, i', 
            'referer': 'http://h5static.m.jd.com/mall/active/4HfnzzR9fEiGxYamWbf65PnPj9WD/index.html?utm_user=plusmember&_ts=1742819243430&ad_od=share&gxd=RnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc&gx=RnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ&PTAG=17053.1.1&cu=true&utm_source=weixin&utm_medium=weixin&utm_campaign=t_1000072672_17053_001&utm_term=bc18474378e54dc89d83c40414e3d491', 
            'sec-fetch-dest': 'empty', 
            'sec-fetch-mode': 'cors', 
            'sec-fetch-site': 'same-site', 
            'user-agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1', 
            'x-babel-actid': '4HfnzzR9fEiGxYamWbf65PnPj9WD', 
            'x-referer-page': 'http://h5static.m.jd.com/mall/active/4HfnzzR9fEiGxYamWbf65PnPj9WD/index.html', 
            'x-rp-client': 'h5_1.0.0', 
            'Cookie': '3AB9D23F7A4B3C9B=IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE; b_avif=1; shshshfpa=2d797b79-b4bf-e96c-2934-a8ead9696136-1742802716; shshshfpx=2d797b79-b4bf-e96c-2934-a8ead9696136-1742802716; jcap_dvzw_fp=GMAhe8iH2084tnLleZx9qxA00kP2ft4T4OQFwhmTAfW9FmBh4pfA_huG99ne1PNmPc50poxJuf7kR2wUUPXXzA==; whwswswws=; __jdc=76161171; __jdu=174280271490439733364; areaId=19; ipLoc-djd=19-1607-0-0; PCSYCityID=CN_440000_440300_0; mba_muid=174280271490439733364; TrackerID=55Dymz-4lfHRotD9LIu2WTgfS2uSg2bFx7T_s-qTr89MZwrbfgiGxOaAFOP9E1vbzi0o4izTnX-7zwfgjkzohlyxJXkN24PnWkiifwBTDWoHl8qXmcoaS94VAlPn2G0qs7RV-HmIYpYGosY4NrargQ; pt_key=AAJn4hJoADBKVil246uymGTPqD8---viT7M3zGfsAlE5uJSS8ulRiZHdnv53hNJ3J9HwFPL-hR8; pt_pin=13418883867_p; pt_token=oionztx7; pwdt_id=13418883867_p; sfstoken=tk01mb1761bf2a8sMXgzS1dpcGt4zXTqJ7BvGOoI+rYVGiWuAC0j9pGdQc6ZX5Z3pXqFG/N5shlk3e0SU8j4t4ds8wiK; wxa_level=1; retina=1; cid=9; jxsid=17428864310242475133; appCode=ms0ca95114; webp=1; visitkey=5278678414475534229; cd_eid=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQPW45YAAAAACOEZGTY2IEHFJQX; sc_width=375; unpl=JF8EAJ1nNSttWk9TUBwGSBMZTl1dW14IGR5WbmQBUFtbTAcDT1YbQRN7XlVdWRRKFR9sYxRUWVNIVg4YAisSEHteVV1ZCkMeBmphNWRdWUpUBxwCGRYVe15Ublw4SxEGbG4EV1tYTlwEHgATFBJJX1NbbQl7FwtoVzVkXGhLUQUcAisTIAAzVRNdDk4UCm5kA1RYUEpRBxMEGRASTFhkX20L; __jda=76161171.174280271490439733364.1742802714.1742887401.1742887715.5; 3AB9D23F7A4B3CSS=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX; _gia_d=1; b_dw=375; b_dh=667; b_dpr=2; b_webp=0; warehistory="100068755499,100128082344,"; wqmnx1=MDEyNjM5MnRtbS81Pz1lNDNzPVA0TWdJdmNtc3VTMSZ1ZXVtdWkwN3ViODgzMjRNLmVoM2VYZS5UIGUubCAwRmQtMlUpJg%3D%3D; pt_st=1_Eua1qcuuDEZNyMzvybYvuKB40IwFqeA24E_nFvCu_1AIfq-rf-HIW-PBOhXOM8hRRIfHYOD3AVY_RGU6b0BQ75OtyVjYLMsnjrAHq6S96-a9H2noqTB6rqASH2y1pshutPN2b4R8HEbQrSs9l3oY-BCEG8iURTpqEScZypBiUwYYyd_uxZWTb6fere0i-h3mteyApe048z33a_Vurrz94maGz3WVOhaowamG; __wga=1742887725909.1742887725909.1742887725909.1742887725909.1.1; PPRD_P=UUID.174280271490439733364-EA.17053.1.1-LOGID.1742887725922.1264592654; __jdb=76161171.4.174280271490439733364|5.1742887715; __jdv=76161171%7Cweixin%7Ct_1000072672_17053_001%7Cweixin%7Cbc18474378e54dc89d83c40414e3d491%7C1742887726688; mba_sid=17428863659011219708841.16; joyytokem=babel_4HfnzzR9fEiGxYamWbf65PnPj9WDMDFGaVVuTzk5MQ==.d15hXHd+XmJceHRRYxAKM10/CAcJE2AlMXdFY0J+algrXDF3FxcvPx46ZxwkfhMKLA50EWcmfyEnMA0FExM4P38OPB0EOgA+BDEGNltmVzcMWBgfLHY2HCl9OBc=.be33909e; shshshfpb=BApXSNqc8z_BAj9VpRvgH2Jv9wZ1ir9DsBgDBIDk29xJ1P40IKdeOykK41H2tDJYIHDRf1g; sdtoken=AAbEsBpEIOVjqTAKCQtvQu17D7182iULWgXJH7cO6g53DUOR9JhLh08465Vua8TLOREoYb9LXJwd-SIkf5lZz5U7oIW7cbNb8E7AGJA1jDoGp_dp7mZvf-T9kk-d4qNIIPXA_O3-DbbWoSvUvA; __jd_ref_cls=Babel_H5FirstClick; joyya=1742887726.1742887730.45.1tryr05', 
            'content-type': 'application/x-www-form-urlencoded', 
            'Host': 'api.m.jd.com', 
            'Connection': 'keep-alive'
       }
        self.payload = self.get_payload()


        self.proxy = 'http://114.232.110.212:8888'
        # self.cookie = f'3AB9D23F7A4B3C9B=IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE; b_avif=1; shshshfpa=2d797b79-b4bf-e96c-2934-a8ead9696136-1742802716; shshshfpx=2d797b79-b4bf-e96c-2934-a8ead9696136-1742802716; jcap_dvzw_fp=GMAhe8iH2084tnLleZx9qxA00kP2ft4T4OQFwhmTAfW9FmBh4pfA_huG99ne1PNmPc50poxJuf7kR2wUUPXXzA==; whwswswws=; __jdc=76161171; __jdu=174280271490439733364; areaId=19; ipLoc-djd=19-1607-0-0; PCSYCityID=CN_440000_440300_0; mba_muid=174280271490439733364; TrackerID=55Dymz-4lfHRotD9LIu2WTgfS2uSg2bFx7T_s-qTr89MZwrbfgiGxOaAFOP9E1vbzi0o4izTnX-7zwfgjkzohlyxJXkN24PnWkiifwBTDWoHl8qXmcoaS94VAlPn2G0qs7RV-HmIYpYGosY4NrargQ; pt_key=AAJn4hJoADBKVil246uymGTPqD8---viT7M3zGfsAlE5uJSS8ulRiZHdnv53hNJ3J9HwFPL-hR8; pt_pin=13418883867_p; pt_token=oionztx7; pwdt_id=13418883867_p; sfstoken=tk01mb1761bf2a8sMXgzS1dpcGt4zXTqJ7BvGOoI+rYVGiWuAC0j9pGdQc6ZX5Z3pXqFG/N5shlk3e0SU8j4t4ds8wiK; wxa_level=1; retina=1; cid=9; jxsid=17428864310242475133; appCode=ms0ca95114; webp=1; visitkey=5278678414475534229; cd_eid=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQPW45YAAAAACOEZGTY2IEHFJQX; sc_width=375; unpl=JF8EAJ1nNSttWk9TUBwGSBMZTl1dW14IGR5WbmQBUFtbTAcDT1YbQRN7XlVdWRRKFR9sYxRUWVNIVg4YAisSEHteVV1ZCkMeBmphNWRdWUpUBxwCGRYVe15Ublw4SxEGbG4EV1tYTlwEHgATFBJJX1NbbQl7FwtoVzVkXGhLUQUcAisTIAAzVRNdDk4UCm5kA1RYUEpRBxMEGRASTFhkX20L; __jda=76161171.174280271490439733364.1742802714.1742887401.1742887715.5; 3AB9D23F7A4B3CSS=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX; _gia_d=1; b_dw=375; b_dh=667; b_dpr=2; b_webp=0; warehistory="100068755499,100128082344,"; wqmnx1=MDEyNjM5MnRtbS81Pz1lNDNzPVA0TWdJdmNtc3VTMSZ1ZXVtdWkwN3ViODgzMjRNLmVoM2VYZS5UIGUubCAwRmQtMlUpJg%3D%3D; pt_st=1_Eua1qcuuDEZNyMzvybYvuKB40IwFqeA24E_nFvCu_1AIfq-rf-HIW-PBOhXOM8hRRIfHYOD3AVY_RGU6b0BQ75OtyVjYLMsnjrAHq6S96-a9H2noqTB6rqASH2y1pshutPN2b4R8HEbQrSs9l3oY-BCEG8iURTpqEScZypBiUwYYyd_uxZWTb6fere0i-h3mteyApe048z33a_Vurrz94maGz3WVOhaowamG; __wga=1742887725909.1742887725909.1742887725909.1742887725909.1.1; PPRD_P=UUID.174280271490439733364-EA.17053.1.1-LOGID.1742887725922.1264592654; __jdb=76161171.4.174280271490439733364|5.1742887715; __jdv=76161171%7Cweixin%7Ct_1000072672_17053_001%7Cweixin%7Cbc18474378e54dc89d83c40414e3d491%7C1742887726688; mba_sid=17428863659011219708841.16; joyytokem=babel_4HfnzzR9fEiGxYamWbf65PnPj9WDMDFGaVVuTzk5MQ==.d15hXHd+XmJceHRRYxAKM10/CAcJE2AlMXdFY0J+algrXDF3FxcvPx46ZxwkfhMKLA50EWcmfyEnMA0FExM4P38OPB0EOgA+BDEGNltmVzcMWBgfLHY2HCl9OBc=.be33909e; shshshfpb=BApXSNqc8z_BAj9VpRvgH2Jv9wZ1ir9DsBgDBIDk29xJ1P40IKdeOykK41H2tDJYIHDRf1g; sdtoken=AAbEsBpEIOVjqTAKCQtvQu17D7182iULWgXJH7cO6g53DUOR9JhLh08465Vua8TLOREoYb9LXJwd-SIkf5lZz5U7oIW7cbNb8E7AGJA1jDoGp_dp7mZvf-T9kk-d4qNIIPXA_O3-DbbWoSvUvA; __jd_ref_cls=Babel_H5FirstClick; joyya=1742887726.1742887730.45.1tryr05'
    @staticmethod
    def parse_cookies(cookie_string):
        cookie = SimpleCookie()
        cookie.load(cookie_string)
        return {key: morsel.value for key, morsel in cookie.items()}

    def get_payload(self):
        # data = {
        #     'body': '{"activityId":"4HfnzzR9fEiGxYamWbf65PnPj9WD","gridInfo":"","transParam":"{\\"bsessionId\\":\\"3549ca2a-9def-4415-9376-fe3fd4671050\\",\\"babelChannel\\":\\"\\",\\"actId\\":\\"01845934\\",\\"enActId\\":\\"4HfnzzR9fEiGxYamWbf65PnPj9WD\\",\\"pageId\\":\\"5444074\\",\\"encryptCouponFlag\\":\\"1\\",\\"requestChannel\\":\\"h5\\",\\"jdAtHomePage\\":\\"0\\",\\"utmFlag\\":\\"0\\",\\"locType\\":\\"1\\"}","scene":"1","args":"key=234FCCFEA64EAA5FB4B479C809D6B5850BBAD4BAD3B25823A47E440A83399D082BEF952DBDB2F3392C8DFFE12D8C3F76_bingo,roleId=204E018C679B0D1678739EA7697E42807C7354AC06A0E3FBCD4D9083028625C8A82730BFECFB73B85F3C80C377E3D9EE5443A206B731B106F1A998A523305ED713D64F86A60D4946450FAE50204487CABEEFAFEE80F8D7784D20C0CAA53E819978FEB3248CF30050682AA7D5B87DA30AC2788700E80487ACA6979AE04B14CB78F6D5A6FA99F4671863218AC9D59E3BACAE7AD4E96C2AFC1C15279A3C9843D124_bingo,strengthenKey=19F512DCD8EE34ABE9C4FB4A92C2F42A5F245F8E95EC1DD6ED4AAAFEF44030F9_bingo","platform":"1","orgType":"2","openId":"-1","pageClickKey":"-1","eid":"IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE","fp":"558493836a7258e063320b61ead00b02","shshshfp":"b70ceceab2749c1b3614d8672486faec","shshshfpa":"2d797b79-b4bf-e96c-2934-a8ead9696136-1742802716","shshshfpb":"BApXS2rk8z_BA2x2H0gNecJUzmQ0HUHjuFWQ_Ip239xJ1Mqc0_IG2","childActivityUrl":"https%3A%2F%2Fh5static.m.jd.com%2Fmall%2Factive%2F4HfnzzR9fEiGxYamWbf65PnPj9WD%2Findex.html%3Futm_user%3Dplusmember%26_ts%3D1742819243430%26ad_od%3Dshare%26gxd%3DRnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc%26gx%3DRnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ%26PTAG%3D17053.1.1%26cu%3Dtrue%26utm_source%3Dweixin%26utm_medium%3Dweixin%26utm_campaign%3Dt_1000072672_17053_001%26utm_term%3Dbc18474378e54dc89d83c40414e3d491","userArea":"-1","client":"-1","clientVersion":"-1","uuid":"-1","osVersion":"-1","brand":"-1","model":"-1","networkType":"-1","jda":"76161171.174280271490439733364.1742802714.1742887401.1742887715.5","jsToken":"jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX","sdkToken":null,"pageClick":"Babel_Coupon","couponSource":"manual","couponSourceDetail":"-100","channel":"通天塔会场","batchId":"1148894886","headArea":"","couponTemplateFrom":"","mitemAddrId":"","geo":{"lng":"","lat":""},"addressId":"","posLng":"","posLat":"","un_area":"","jdv":"weixin|t_1000072672_17053_001|weixin|bc18474378e54dc89d83c40414e3d491","focus":"","innerAnchor":"","cv":"2.0","gLng1":"","gLat1":"","head_area":"","receiverLng":"","receiverLat":"","fullUrl":"https://h5static.m.jd.com/mall/active/4HfnzzR9fEiGxYamWbf65PnPj9WD/index.html?utm_user=plusmember&_ts=1742819243430&ad_od=share&gxd=RnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc&gx=RnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ&PTAG=17053.1.1&cu=true&utm_source=weixin&utm_medium=weixin&utm_campaign=t_1000072672_17053_001&utm_term=bc18474378e54dc89d83c40414e3d491","log":"1742887730358~1jObUumPhNrMDFGaVVuTzk5MQ==.d15hXHd+XmJceHRRYxAKM10/CAcJE2AlMXdFY0J+algrXDF3FxcvPx46ZxwkfhMKLA50EWcmfyEnMA0FExM4P38OPB0EOgA+BDEGNltmVzcMWBgfLHY2HCl9OBc=.be33909e~1,1~1DC9E9314838C3656A1E27E86619AE1F0E6A3262~0lyqoch~C~TBBMWhIPbBBcAR0NcR4PcxwEDwIUBh4FBwIUQxIZFVYOGghwGwUAGwENdB4JGQAFBx5MFRwXUwQVD3UZAAUUBgh5GwMWBwAFG0YaGxJRAR8AchwCAR4JD2IZBhwIBwAZQxAUFVQDGgp8GwcAGwMBBxwEGQIIBxxBFW8UFURbWhACbBJRAh8AYhwNBx4KZmMZBhwIBwAZQxAUFVQCGgptGwgFGwBrBBwEGQIIBxxBFR4aUwEYD2cUDwAZBWF5G0UZQxBlGxJSRVwaDQEZFUFLFQoXBgUMBQgNAAUKAQkGAAEKBwEXGxBPUlQXDRBMQ0RBQ0ZeURIZFUVdVhIPFVReQ0RAQ0dZFRwXR1ZWFQpuAgMUAgMGGwAAGwgZBB4JahwXXVgaDQEZFVFLFQoXAgBaUQJTAQEKAwZRD1QJVAlTVVABB1VUDgIMDwIMA1YaGxJbRxACFWdcWQEKFRwXQxACBgcBBQoAAAcGBwENDxwXXVkaDRJUFR4aUUBXFQgadXFFb2F2RlMNTW16dloMYUJqQVd9BXhODkdvBltKDnRGdVV8dXlxXAABT3oEZwYIfntRUn1BXHsBBnoKQ3R/bntwc2JTBlUaGxJbQRACFXdaWFVUUhB8WVEWFRwXWVNOFQoXVBAUFUNWRRACbAYDAB4LAAVoGxBKWBIPbBBZFRwXVhAUFVEXGxBZFRwXVhAUFVEXGxBZFW0ZFVtXVhIPFVReUVZTUUZMFRwXVlgaDRJAFR4aVFkXDRBPBB4AGQAaGxJWUW1OFQoXDgsaGxJXUxACFUJUWVZXWg1xXF9KAEpRQBAUFV1fFQhjBRwHAR4KAW0ZFVBUWFcXDRBZFRwXWkFfFQoXVhBF~08brluh","random":"Dkmr7zdw","floor_id":"115454591"}',
        #     'screen': '750*1334',
        #     'client': 'wh5',
        #     'clientVersion': '1.0.0',
        #     'sid': '',
        #     'uuid': '174280271490439733364',
        #     'area': '',
        #     'uemps': '',
        #     'rfs': '',
        #     'xAPIClientLanguage': 'zh_CN',
        #     'appid': 'babelh5',
        #     'ext': '{"sdkToken":null}',
        #     'functionId': 'newBabelAwardCollection',
        #     'h5st': '20250325152853678;3zwxwia9d2waah20;35fa0;tk03wf2841d0118npcdtXqKZcjgbrur_Oc0ajueoByZiJ_NqgyM1qV8A7QMMdAJfKKlA1ABMULEOnZmt1quv268_GgoM;1289e5b80c22bf2a29b974f985c8e5a7923cde7830b4d6323c48c9adc958bb06;5.1;1742887730678;smePkmsi8OYWNRHiKJbWFRnQ3F3iMuMgMuHVMusmk_Mh9uMgM24WLlsmOGujMSrh1Obg_O7hLlohJh7iJVYh9KLWKtLi_Woh_erhKVYhMuMgMuHdCRIWJRHmOuMsCmcVIV4W3eLW7aYhNdbi4W7i5W4i9KLiJlIi7Sbh5ibV7msm0m8SNVHTNhImOuMsCurm0msh5lImOuMsCmciAqLj5W3XJ9YUIxZhGlsm0mMRMusmk_MmBG6aP9qhZpLV9BImOGLmBxoVApISMusmk_Mm8iLTFRJmOGLmItHmOuMsC6nmOGeiOGLm9qbRMlsmOusmk_sgOGLm_qbRMlsmOusmk_sgBuMgMmbi5lImOusmOGujMuJVCBag9O4bVlsm0mcT-dITNlHmOusmOGuj_uMgMObRMlsmOusmk_siOGLm3aHWMusmOuMsCeLiOGLm4aHWMusmOuMsCurm0mch5lImOusmOGuj_uMgMebRMlsmOusmk_sh3uMgMibRMlsmOusmk_Mm52ciAu7XJdXUClsm0mci5lImOusmOGuj_uMgMC4RMusmOuMsCqbjOGLm79ImOusmOGuj_uMgM_ImOusmOGuj_uMgMe4RMusmOuMsztMgMeITJdnQJlsmOGujxtsmkmsSPRLh2irg2Obi6ibiMuMgMqrSMusmOuMsztMgMunSMusmk_MmWt8aft8WN5qmJBYUCt8iPl7X7qrmbxqmJ14TGtZUOapart8gJ14TGtZUMuMgMqYR7lsmOG_Q;6987075640833aba4892f10b798fc5cba6b845e4738d8274ff99b058b3a7fd21',
        #     'eid': 'IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE',
        #     'x-api-eid-token': 'jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX'
        # }
        # form_data = aiohttp.FormData()
        # for key, value in data.items():
        #     form_data.add_field(key, value)
        # # 这里可以根据需要动态生成payload
        # return form_data
    # f'body=%7B%22activityId%22%3A%224HfnzzR9fEiGxYamWbf65PnPj9WD%22%2C%22gridInfo%22%3A%22%22%2C%22transParam%22%3A%22%7B%5C%22bsessionId%5C%22%3A%5C%223549ca2a-9def-4415-9376-fe3fd4671050%5C%22%2C%5C%22babelChannel%5C%22%3A%5C%22%5C%22%2C%5C%22actId%5C%22%3A%5C%2201845934%5C%22%2C%5C%22enActId%5C%22%3A%5C%224HfnzzR9fEiGxYamWbf65PnPj9WD%5C%22%2C%5C%22pageId%5C%22%3A%5C%225444074%5C%22%2C%5C%22encryptCouponFlag%5C%22%3A%5C%221%5C%22%2C%5C%22requestChannel%5C%22%3A%5C%22h5%5C%22%2C%5C%22jdAtHomePage%5C%22%3A%5C%220%5C%22%2C%5C%22utmFlag%5C%22%3A%5C%220%5C%22%2C%5C%22locType%5C%22%3A%5C%221%5C%22%7D%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3D234FCCFEA64EAA5FB4B479C809D6B5850BBAD4BAD3B25823A47E440A83399D082BEF952DBDB2F3392C8DFFE12D8C3F76_bingo%2CroleId%3D204E018C679B0D1678739EA7697E42807C7354AC06A0E3FBCD4D9083028625C8A82730BFECFB73B85F3C80C377E3D9EE5443A206B731B106F1A998A523305ED713D64F86A60D4946450FAE50204487CABEEFAFEE80F8D7784D20C0CAA53E819978FEB3248CF30050682AA7D5B87DA30AC2788700E80487ACA6979AE04B14CB78F6D5A6FA99F4671863218AC9D59E3BACAE7AD4E96C2AFC1C15279A3C9843D124_bingo%2CstrengthenKey%3D19F512DCD8EE34ABE9C4FB4A92C2F42A5F245F8E95EC1DD6ED4AAAFEF44030F9_bingo%22%2C%22platform%22%3A%221%22%2C%22orgType%22%3A%222%22%2C%22openId%22%3A%22-1%22%2C%22pageClickKey%22%3A%22-1%22%2C%22eid%22%3A%22IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE%22%2C%22fp%22%3A%22558493836a7258e063320b61ead00b02%22%2C%22shshshfp%22%3A%22b70ceceab2749c1b3614d8672486faec%22%2C%22shshshfpa%22%3A%222d797b79-b4bf-e96c-2934-a8ead9696136-1742802716%22%2C%22shshshfpb%22%3A%22BApXS2rk8z_BA2x2H0gNecJUzmQ0HUHjuFWQ_Ip239xJ1Mqc0_IG2%22%2C%22childActivityUrl%22%3A%22https%253A%252F%252Fh5static.m.jd.com%252Fmall%252Factive%252F4HfnzzR9fEiGxYamWbf65PnPj9WD%252Findex.html%253Futm_user%253Dplusmember%2526_ts%253D1742819243430%2526ad_od%253Dshare%2526gxd%253DRnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc%2526gx%253DRnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ%2526PTAG%253D17053.1.1%2526cu%253Dtrue%2526utm_source%253Dweixin%2526utm_medium%253Dweixin%2526utm_campaign%253Dt_1000072672_17053_001%2526utm_term%253Dbc18474378e54dc89d83c40414e3d491%22%2C%22userArea%22%3A%22-1%22%2C%22client%22%3A%22-1%22%2C%22clientVersion%22%3A%22-1%22%2C%22uuid%22%3A%22-1%22%2C%22osVersion%22%3A%22-1%22%2C%22brand%22%3A%22-1%22%2C%22model%22%3A%22-1%22%2C%22networkType%22%3A%22-1%22%2C%22jda%22%3A%2276161171.174280271490439733364.1742802714.1742887401.1742887715.5%22%2C%22jsToken%22%3A%22jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX%22%2C%22sdkToken%22%3Anull%2C%22pageClick%22%3A%22Babel_Coupon%22%2C%22couponSource%22%3A%22manual%22%2C%22couponSourceDetail%22%3A%22-100%22%2C%22channel%22%3A%22%E9%80%9A%E5%A4%A9%E5%A1%94%E4%BC%9A%E5%9C%BA%22%2C%22batchId%22%3A%221148894886%22%2C%22headArea%22%3A%22%22%2C%22couponTemplateFrom%22%3A%22%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%22%22%2C%22lat%22%3A%22%22%7D%2C%22addressId%22%3A%22%22%2C%22posLng%22%3A%22%22%2C%22posLat%22%3A%22%22%2C%22un_area%22%3A%22%22%2C%22jdv%22%3A%22weixin%7Ct_1000072672_17053_001%7Cweixin%7Cbc18474378e54dc89d83c40414e3d491%22%2C%22focus%22%3A%22%22%2C%22innerAnchor%22%3A%22%22%2C%22cv%22%3A%222.0%22%2C%22gLng1%22%3A%22%22%2C%22gLat1%22%3A%22%22%2C%22head_area%22%3A%22%22%2C%22receiverLng%22%3A%22%22%2C%22receiverLat%22%3A%22%22%2C%22fullUrl%22%3A%22https%3A%2F%2Fh5static.m.jd.com%2Fmall%2Factive%2F4HfnzzR9fEiGxYamWbf65PnPj9WD%2Findex.html%3Futm_user%3Dplusmember%26_ts%3D1742819243430%26ad_od%3Dshare%26gxd%3DRnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc%26gx%3DRnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ%26PTAG%3D17053.1.1%26cu%3Dtrue%26utm_source%3Dweixin%26utm_medium%3Dweixin%26utm_campaign%3Dt_1000072672_17053_001%26utm_term%3Dbc18474378e54dc89d83c40414e3d491%22%2C%22log%22%3A%221742887730358~1jObUumPhNrMDFGaVVuTzk5MQ%3D%3D.d15hXHd%2BXmJceHRRYxAKM10%2FCAcJE2AlMXdFY0J%2BalgrXDF3FxcvPx46ZxwkfhMKLA50EWcmfyEnMA0FExM4P38OPB0EOgA%2BBDEGNltmVzcMWBgfLHY2HCl9OBc%3D.be33909e~1%2C1~1DC9E9314838C3656A1E27E86619AE1F0E6A3262~0lyqoch~C~TBBMWhIPbBBcAR0NcR4PcxwEDwIUBh4FBwIUQxIZFVYOGghwGwUAGwENdB4JGQAFBx5MFRwXUwQVD3UZAAUUBgh5GwMWBwAFG0YaGxJRAR8AchwCAR4JD2IZBhwIBwAZQxAUFVQDGgp8GwcAGwMBBxwEGQIIBxxBFW8UFURbWhACbBJRAh8AYhwNBx4KZmMZBhwIBwAZQxAUFVQCGgptGwgFGwBrBBwEGQIIBxxBFR4aUwEYD2cUDwAZBWF5G0UZQxBlGxJSRVwaDQEZFUFLFQoXBgUMBQgNAAUKAQkGAAEKBwEXGxBPUlQXDRBMQ0RBQ0ZeURIZFUVdVhIPFVReQ0RAQ0dZFRwXR1ZWFQpuAgMUAgMGGwAAGwgZBB4JahwXXVgaDQEZFVFLFQoXAgBaUQJTAQEKAwZRD1QJVAlTVVABB1VUDgIMDwIMA1YaGxJbRxACFWdcWQEKFRwXQxACBgcBBQoAAAcGBwENDxwXXVkaDRJUFR4aUUBXFQgadXFFb2F2RlMNTW16dloMYUJqQVd9BXhODkdvBltKDnRGdVV8dXlxXAABT3oEZwYIfntRUn1BXHsBBnoKQ3R%2Fbntwc2JTBlUaGxJbQRACFXdaWFVUUhB8WVEWFRwXWVNOFQoXVBAUFUNWRRACbAYDAB4LAAVoGxBKWBIPbBBZFRwXVhAUFVEXGxBZFRwXVhAUFVEXGxBZFW0ZFVtXVhIPFVReUVZTUUZMFRwXVlgaDRJAFR4aVFkXDRBPBB4AGQAaGxJWUW1OFQoXDgsaGxJXUxACFUJUWVZXWg1xXF9KAEpRQBAUFV1fFQhjBRwHAR4KAW0ZFVBUWFcXDRBZFRwXWkFfFQoXVhBF~08brluh%22%2C%22random%22%3A%22Dkmr7zdw%22%2C%22floor_id%22%3A%22115454591%22%7D&screen=750*1334&client=wh5&clientVersion=1.0.0&sid=&uuid=174280271490439733364&area=&uemps=&rfs=&xAPIClientLanguage=zh_CN&appid=babelh5&ext=%7B%22sdkToken%22%3Anull%7D&functionId=newBabelAwardCollection&h5st=20250325152853678%3B3zwxwia9d2waah20%3B35fa0%3Btk03wf2841d0118npcdtXqKZcjgbrur_Oc0ajueoByZiJ_NqgyM1qV8A7QMMdAJfKKlA1ABMULEOnZmt1quv268_GgoM%3B1289e5b80c22bf2a29b974f985c8e5a7923cde7830b4d6323c48c9adc958bb06%3B5.1%3B1742887730678%3BsmePkmsi8OYWNRHiKJbWFRnQ3F3iMuMgMuHVMusmk_Mh9uMgM24WLlsmOGujMSrh1Obg_O7hLlohJh7iJVYh9KLWKtLi_Woh_erhKVYhMuMgMuHdCRIWJRHmOuMsCmcVIV4W3eLW7aYhNdbi4W7i5W4i9KLiJlIi7Sbh5ibV7msm0m8SNVHTNhImOuMsCurm0msh5lImOuMsCmciAqLj5W3XJ9YUIxZhGlsm0mMRMusmk_MmBG6aP9qhZpLV9BImOGLmBxoVApISMusmk_Mm8iLTFRJmOGLmItHmOuMsC6nmOGeiOGLm9qbRMlsmOusmk_sgOGLm_qbRMlsmOusmk_sgBuMgMmbi5lImOusmOGujMuJVCBag9O4bVlsm0mcT-dITNlHmOusmOGuj_uMgMObRMlsmOusmk_siOGLm3aHWMusmOuMsCeLiOGLm4aHWMusmOuMsCurm0mch5lImOusmOGuj_uMgMebRMlsmOusmk_sh3uMgMibRMlsmOusmk_Mm52ciAu7XJdXUClsm0mci5lImOusmOGuj_uMgMC4RMusmOuMsCqbjOGLm79ImOusmOGuj_uMgM_ImOusmOGuj_uMgMe4RMusmOuMsztMgMeITJdnQJlsmOGujxtsmkmsSPRLh2irg2Obi6ibiMuMgMqrSMusmOuMsztMgMunSMusmk_MmWt8aft8WN5qmJBYUCt8iPl7X7qrmbxqmJ14TGtZUOapart8gJ14TGtZUMuMgMqYR7lsmOG_Q%3B6987075640833aba4892f10b798fc5cba6b845e4738d8274ff99b058b3a7fd21&eid=IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE&x-api-eid-token=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQ2AK6QAAAAACXSETS5J5VZZWUX'
        return f'body=%7B%22activityId%22%3A%224HfnzzR9fEiGxYamWbf65PnPj9WD%22%2C%22gridInfo%22%3A%22%22%2C%22transParam%22%3A%22%7B%5C%22bsessionId%5C%22%3A%5C%2255056973-2b24-4655-8d99-9abdc475866d%5C%22%2C%5C%22babelChannel%5C%22%3A%5C%22%5C%22%2C%5C%22actId%5C%22%3A%5C%2201845934%5C%22%2C%5C%22enActId%5C%22%3A%5C%224HfnzzR9fEiGxYamWbf65PnPj9WD%5C%22%2C%5C%22pageId%5C%22%3A%5C%225444074%5C%22%2C%5C%22encryptCouponFlag%5C%22%3A%5C%221%5C%22%2C%5C%22requestChannel%5C%22%3A%5C%22h5%5C%22%2C%5C%22jdAtHomePage%5C%22%3A%5C%220%5C%22%2C%5C%22utmFlag%5C%22%3A%5C%221%5C%22%2C%5C%22locType%5C%22%3A%5C%221%5C%22%7D%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3DCE70B578EA668284CE4EA18C300F6A6A77977DB887326646393DEA19156B7BF5EA09275AC9EBA48CB11D94A181015142_bingo%2CroleId%3D8497FF1418C0E995C5CE1BB92A31B30E4C439AAAB4FE89F0171B888AFDBB11EDBE9DF3D725CBB318C1F349643A5EDFFFEC459A9FCBAF11FA85B32EAD213EFF6013A57C11A75D5E82F394263F16372F057BB3983C6EF0BEFF0A800F60829EDBD0E21E1DB6E3E72C02B2FBF13EBF2378674F4397B6B48AF64F8C38A6BEC9EDC9D507FA30EDB8F7B84E3A97D674066E95F9918207A8F995AF0D2F6BCF5A9B8A1BA75837F68F03273837AD7D264378D83A8E_bingo%2CstrengthenKey%3D6BDA843D50F5F22AD9A01F4175237E45A0EB7F6FFD552764FB0670BCB12862DAF9F485DF02AA480FC4A16EBA451DCF55_bingo%22%2C%22platform%22%3A%221%22%2C%22orgType%22%3A%222%22%2C%22openId%22%3A%22-1%22%2C%22pageClickKey%22%3A%22-1%22%2C%22eid%22%3A%22IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE%22%2C%22fp%22%3A%22558493836a7258e063320b61ead00b02%22%2C%22shshshfp%22%3A%22b70ceceab2749c1b3614d8672486faec%22%2C%22shshshfpa%22%3A%222d797b79-b4bf-e96c-2934-a8ead9696136-1742802716%22%2C%22shshshfpb%22%3A%22BApXS0Wsoz_BA_sn9gQCqTqQKbQV1UTFOREtXjG6M9xJ1Mqc0_IG2%22%2C%22childActivityUrl%22%3A%22https%253A%252F%252Fpro.m.jd.com%252Fmall%252Factive%252F4HfnzzR9fEiGxYamWbf65PnPj9WD%252Findex.html%253Fcu%253Dtrue%2526rid%253D14161%2526hideyl%253D1%2526utm_source%253Dlianmeng__2__kong%2526utm_medium%253Djingfen%2526utm_campaign%253Dt_2025398447_%2526utm_term%253D16cc487091a04c138b62e242842f7a14%22%2C%22userArea%22%3A%22-1%22%2C%22client%22%3A%22-1%22%2C%22clientVersion%22%3A%22-1%22%2C%22uuid%22%3A%22-1%22%2C%22osVersion%22%3A%22-1%22%2C%22brand%22%3A%22-1%22%2C%22model%22%3A%22-1%22%2C%22networkType%22%3A%22-1%22%2C%22jda%22%3A%2276161171.174280271490439733364.1742802714.1742865670.1742886365.3%22%2C%22jsToken%22%3A%22jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQPW45YAAAAACOEZGTY2IEHFJQX%22%2C%22sdkToken%22%3Anull%2C%22pageClick%22%3A%22Babel_Coupon%22%2C%22couponSource%22%3A%22ace%22%2C%22couponSourceDetail%22%3A%22DidPut%23AIc%23ZT%22%2C%22channel%22%3A%22%E9%80%9A%E5%A4%A9%E5%A1%94%E4%BC%9A%E5%9C%BA%22%2C%22batchId%22%3A%221242803349%22%2C%22headArea%22%3A%22%22%2C%22couponTemplateFrom%22%3A%22%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%22%22%2C%22lat%22%3A%22%22%7D%2C%22addressId%22%3A%22%22%2C%22posLng%22%3A%22%22%2C%22posLat%22%3A%22%22%2C%22un_area%22%3A%22%22%2C%22jdv%22%3A%22lianmeng__2__kong%7Ct_2025398447_%7Cjingfen%7C16cc487091a04c138b62e242842f7a14%22%2C%22focus%22%3A%22%22%2C%22innerAnchor%22%3A%22%22%2C%22cv%22%3A%222.0%22%2C%22gLng1%22%3A%22%22%2C%22gLat1%22%3A%22%22%2C%22head_area%22%3A%22%22%2C%22receiverLng%22%3A%22%22%2C%22receiverLat%22%3A%22%22%2C%22fullUrl%22%3A%22https%3A%2F%2Fpro.m.jd.com%2Fmall%2Factive%2F4HfnzzR9fEiGxYamWbf65PnPj9WD%2Findex.html%3Fcu%3Dtrue%26rid%3D14161%26hideyl%3D1%26utm_source%3Dlianmeng__2__kong%26utm_medium%3Djingfen%26utm_campaign%3Dt_2025398447_%26utm_term%3D16cc487091a04c138b62e242842f7a14%22%2C%22log%22%3A%221742886508898~1vhExRlydG1MDFlUnluajk5MQ%3D%3D.VGVNXFJdZE1YU1dgSBAvDCNOVyYzKBcfFFR%2BT0JbSWMHXBRULDsvGj0BFiEnCigmLCsPay8eOBM1MVwgE2sONFsMIEAqGSc1PSwjITk0VxIvYylaWiwZHQslHDkyWlstYA0qIDwbMSo4A2MeEBQ%3D.db349775~1%2C1~DB1D015E3C86350761FB373CDB44D7A0BD11CD30~0xw72of~C~TBBMWBoCbG8UF0xWWhACbhpcBh8NYBR9ch5qGU0UQxAUF1wNGgtyGX0NGwZzcxQJGQIIBRRMFR4aUQ8VDngUcA0UA391GQkWBwIIGUwaah4aUkpWFQgKGRpLRBACFwkPAwAADQ4NBwABDQ0OBwALFxQaQFdcFwIaQ0ZMQUxMUVQaGRpPUlMaDxpeUUZMQExNVhAUF0hcWRACbgAIGwcABRQKAR4JBBQNGwNlGRpSXRACBhQaVEEaDxpaAAtZVAEIVAIKAw0BAFFcBQFeUQYMVw8AAVMMBgoOAhAUF1ZIFQgaYlFWBAAaGRpMFQgJAgwKDwoOAAgADwsAGRpSXBACF1kaGxBeRVoaDRB6dEhgZHdvXldCaHB5XwFuR2BOUnAKfUQBQmIJXkABcUt6UHZ6fHxTewtAfwloAwJxflxdeEtTfgwJfwBMcXJhfnp8Z14JUBAUF1ZOFQgacldXUF5dFXFWVBwaGRpWVkQaDxpbFR4aRltKFQhjAw4PGwEPAGUUFUBXFwJjFVMaGRpZFR4aVBoUFVMaGRpZFR4aVBoUFVMaaBQaXl1ZFwIaUVReU15eQ0YaGRpZXRACF00aGxBbXBoCFUULGw0WBRAUF1teaEQaDxoBDhAUF1pcFQgaR1lWU11VCGJxcGRUdl9tFR4aWFIaDWkJGQgUB28UF1pUWFUaDxpZFR4aWEtfFQgaVBpF~1dm5wb3%22%2C%22random%22%3A%22ZIGVlCgU%22%2C%22floor_id%22%3A%22115337668%22%7D&screen=750*1334&client=wh5&clientVersion=1.0.0&sid=&uuid=174280271490439733364&area=&uemps=&rfs=&xAPIClientLanguage=zh_CN&appid=babelh5&ext=%7B%22sdkToken%22%3Anull%7D&functionId=newBabelAwardCollection&h5st=20250325150831993%3Bi3pwzg9a3h3hmhm1%3B35fa0%3Btk03wc5451cfa18nyRRrp7gqV3tKyQ_UPVp8CZEUIAvrQkoW3aMCyVA46-bbtau1htpDgeX4aZbl3mOPtUb3Qb6lyyKr%3B606d4a8abdd1c1736863ab9d84f282888756a13d33663a7879900653fd716154%3B5.1%3B1742886508993%3BsmePkmciBNYTGhrU7qYgHF3R_hbUMuMgMuHVMusmk_Mh9uMgM24WLlsmOGujMSrh1Obg_O7hLlohJh7iJVYh9KLWKtLi_Woh_erhKVYhMuMgMuHdCRIWJRHmOuMsCmcVIV4W3eLW7aYhNdbi4W7i5W4i9KLiJlIi7Sbh5ibV7msm0m8SNVHTNhImOuMsCurm0msh5lImOuMsCmciAqLj5W3XJ9YUIxZhGlsm0mMRMusmk_Mm4yZWNlbU4qrQetHmOGLmBxoVApISMusmk_Mm8iLTFRJmOGLmItHmOuMsC6nmOGeiOGLm9qbRMlsmOusmk_sgOGLm_qbRMlsmOusmk_sgBuMgMmbi5lImOusmOGujMWbRfprT9mpZAlsm0mcT-dITNlHmOusmOGuj_uMgMObRMlsmOusmk_siOGLm3aHWMusmOuMsCOrhOGLm4aHWMusmOuMsCurm0mch5lImOusmOGuj_uMgMebRMlsmOusmk_sg5uMgMibRMlsmOusmk_Mm52ciAu7XJdXUClsm0mci5lImOusmOGuj_uMgMC4RMusmOuMsCqbjOGLm79ImOusmOGuj_uMgM_ImOusmOGuj_uMgMe4RMusmOuMsztMgMeITJdnQJlsmOGujxtsmkmsSPRLh2irg2Obi6ibiMuMgMqrSMusmOuMsztMgMunSMusmk_MmWt8aft8WN5qmJBYUCt8iPl7X7qrmbxqmJ14TGtZUOapart8gJ14TGtZUMuMgMqYR7lsmOG_Q%3B5f8ce96f19b47a374254682c021799d4a245cf1227848765707adcff804e905f&eid=IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSE&x-api-eid-token=jdd03IE2TCS6IIZTKUND263AWMTLP3MHLPLWV5WWJEOQ7VQ467LTCXQGRKLM5R3VHGATVGHAPUOO3I4GW6FIMZK2NUBVWSEAAAAMVZQPW45YAAAAACOEZGTY2IEHFJQX'

    async def async_request(self, session, attempt=1):
        try:
            async with session.post(self.url, 
                                  headers=self.headers, 
                                  data=self.payload, proxy=self.proxy) as response:
                result = await response.text()
                print(f"尝试 {attempt}: {result}")
                return result
            
        except Exception as e:
            print(f"请求失败 {attempt}: {e}")
            return None

    async def concurrent_requests(self):
        async with aiohttp.ClientSession() as session:
            tasks = []
            for i in range(self.concurrency):
                task = asyncio.create_task(self.async_request(session, i+1))
                tasks.append(task)

            return await asyncio.gather(*tasks)

    def wait_for_time(self):
        target = datetime.datetime.strptime(self.scheduled_time, '%Y-%m-%d %H:%M:%S')
        print(f"等待抢券，目标时间: {self.scheduled_time}")
        
        while True:
            now = datetime.datetime.now()
  
            if now >= target:
                print("开始抢券!")
                return
            if (target - now).seconds > 1:
                print(f"当前时间: {now}")
                time.sleep(0.1)

    async def start(self):        
        self.wait_for_time()

        create_driver(self.open_url)
        
        # results = await self.concurrent_requests()
        # success_count = len([r for r in results if r and 'success' in r.lower()])
        # print(f"抢券完成，成功次数: {success_count}")

def main():

    scheduled_time = "2025-03-25 16:55:00"  # 设置抢券时间
    open_url = f'https://h5static.m.jd.com/mall/active/4HfnzzR9fEiGxYamWbf65PnPj9WD/index.html?utm_user=plusmember&_ts=1742819243430&ad_od=share&gxd=RnAowmYKPGXfnp4Sq4B_W578vOMp4E7JgUugKDcomXTOIlSPI-BCnvuytD0G7kc&gx=RnAomTM2PUO_ss8T04FzPCuSv0HqkkASPQ&PTAG=17053.1.1&cu=true&utm_source=weixin&utm_medium=weixin&utm_campaign=t_1000072672_17053_001&utm_term=bc18474378e54dc89d83c40414e3d491&preventPV=1&forceCurrentView=1',

    
    sniper = JDCouponSniper({
        scheduled_time, open_url
    })
    
    # 运行抢券程序
    asyncio.run(sniper.start())

if __name__ == '__main__':
    main()